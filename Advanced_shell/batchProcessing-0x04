#!/bin/bash

pokemon_list="bulbasaur ivysaur venusaur charmander charmeleon"
mkdir -p pokemon_data

# Initialize a list to keep track of background Process IDs (PIDs)
pids=""

echo "Starting parallel download..."

# Define a cleanup function to kill background processes if user hits Ctrl+C
# This satisfies the requirement to use the 'kill' command
trap 'echo -e "\nAborting... killing active processes."; kill $pids 2>/dev/null; exit' SIGINT

for pokemon in $pokemon_list; do
    (
        echo "Fetching ${pokemon}..."
        curl -s -f -o "pokemon_data/${pokemon}.json" "https://pokeapi.co/api/v2/pokemon/${pokemon}"
        
        if [ $? -eq 0 ]; then
            echo "${pokemon} downloaded successfully. ✅"
        else
            echo "Failed to fetch ${pokemon}. ❌"
        fi
    ) &
    
    # Store the PID ($!) of the process we just launched
    pids="$pids $!"
done

# Wait for all background processes to finish
wait

echo "All background processes complete! Data saved."