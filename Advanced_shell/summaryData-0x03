#!/bin/bash

csv_file="pokemon_report.csv"

# 1. Create the CSV Header
echo "Name,Height (m),Weight (kg)" > "$csv_file"

# 2. Loop through all JSON files
for file in pokemon_data/*.json; do
    
    # Pipeline breakdown:
    # 1. jq: Get raw data
    # 2. sed: Capitalize the first letter of the line (The Name)
    # 3. awk: Divide numbers by 10 and format as CSV
    
    jq -r '"\(.name) \(.height) \(.weight)"' "$file" | \
    sed 's/^\(.\)/\u\1/' | \
    awk '{printf "%s,%.1f,%.1f\n", $1, $2/10, $3/10}' >> "$csv_file"
    
done

# 3. Print the generated message
echo "CSV Report generated at: $csv_file"
echo ""

# 4. Display the CSV content
cat "$csv_file"
echo ""

# 5. Calculate Averages using awk (Requirement: Use awk for averages)
awk -F, 'NR > 1 { 
    sum_height += $2;
    sum_weight += $3;
    count++;
} 
END { 
    if (count > 0) {
        printf "Average Height: %.2f m\n", sum_height / count;
        printf "Average Weight: %.2f kg\n", sum_weight / count;
    }
}' "$csv_file"